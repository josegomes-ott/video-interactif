<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <!-- Pour un affichage adapté sur mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lecture continue de 8 vidéos</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
    }
    #videoContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: #000;
    }
    video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    video.active {
      opacity: 1;
    }
    /* Overlay pour demander l'interaction utilisateur au démarrage */
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.8);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div id="overlay">Cliquez ou touchez pour démarrer</div>
  <div id="videoContainer">
    <video id="video1" playsinline></video>
    <video id="video2" playsinline></video>
  </div>

  <script>
    // Liste des 8 vidéos à lire
    const videos = [
      'dimension1.mp4',
      'dimension2.mp4',
      'dimension3.mp4',
      'dimension4.mp4',
      'dimension5.mp4',
      'dimension6.mp4',
      'dimension7.mp4',
      'dimension8.mp4'
    ];

    let currentIndex = 0;
    // On alterne entre les deux éléments vidéo
    let activeVideo = 1; // 1 ou 2

    const video1 = document.getElementById('video1');
    const video2 = document.getElementById('video2');
    const overlay = document.getElementById('overlay');

    // Renvoie l'élément vidéo actuellement affiché
    function getActiveVideoElement() {
      return activeVideo === 1 ? video1 : video2;
    }
    // Renvoie l'élément vidéo inactif (celui qui servira à précharger la prochaine vidéo)
    function getInactiveVideoElement() {
      return activeVideo === 1 ? video2 : video1;
    }

    // Charge une vidéo dans un élément donné
    function loadVideo(videoElement, src) {
      videoElement.src = src;
      videoElement.load();
    }

    // Bascule entre les deux vidéos (pour un effet de fondu)
    function switchVideo() {
      activeVideo = activeVideo === 1 ? 2 : 1;
      getActiveVideoElement().classList.add('active');
      getInactiveVideoElement().classList.remove('active');
    }

    // Fonction de démarrage qui lance la lecture de la première vidéo et précharge la suivante
    function startPlayback() {
      overlay.style.display = 'none';
      
      // Charge la première vidéo dans video1
      loadVideo(video1, videos[currentIndex]);
      video1.classList.add('active');
      video1.play().catch(err => console.error(err));
      
      // Précharge la suivante dans video2 (si disponible)
      let nextIndex = (currentIndex + 1) % videos.length;
      loadVideo(video2, videos[nextIndex]);

      // Écoute l'événement 'ended' sur les deux vidéos
      video1.addEventListener('ended', onVideoEnded);
      video2.addEventListener('ended', onVideoEnded);
    }

    function onVideoEnded() {
      // Mise à jour de l'index courant
      currentIndex = (currentIndex + 1) % videos.length;
      
      // L'élément inactif est préchargé avec la prochaine vidéo à jouer
      const inactiveVideo = getInactiveVideoElement();
      inactiveVideo.play().then(() => {
        // Dès que la vidéo inactif se lance, on effectue le basculement
        switchVideo();
      }).catch(err => {
        console.error("Erreur lors de la lecture de la vidéo :", err);
      });

      // Précharge la vidéo suivante dans l'élément désormais inactif
      let nextIndex = (currentIndex + 1) % videos.length;
      loadVideo(getInactiveVideoElement(), videos[nextIndex]);
    }

    overlay.addEventListener('pointerdown', () => {
      startPlayback();
    }, { once: true });
  </script>
</body>
</html>

